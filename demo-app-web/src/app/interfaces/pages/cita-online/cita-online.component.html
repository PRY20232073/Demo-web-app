
<h1 class="text-center">Cita online</h1>
<mat-divider></mat-divider>
<div class="container">
    <div class="side-by-side">
        <div class="left-half">
            <img src="../../../../assets/Doctors-bro.svg" alt="Imagen" />
        </div>
          <div class="right-half">
            <mat-card *ngIf="StepperForm == 0">
              <mat-card-content>
                <mat-stepper linear labelPosition="bottom" #stepper>
                 <!-- Paso 1: Datos personales -->
                    <mat-step [stepControl]="stepOneForm" [editable]="true"> 
                        
                        <ng-template matStepperIcon="edit">
                            <mat-icon>check</mat-icon>
                        </ng-template>
                        <ng-template matStepLabel>Paso 1: Datos personales</ng-template>

                        <form [formGroup]="stepOneForm">
                            <br>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                </div>
                                <div class="col-md-11 label-input">
                                    <mat-label >Seleccione el tipo de documento</mat-label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                    <img src="../../../../assets/icons/solar--user-id-outline.svg" alt="Imagen" class="imagen-input"/>

                                </div>
                                <div class="col-md-11">
                                    <mat-form-field appearance="outline">
                                        <mat-select formControlName="tipoDocumento" 
                                            placeholder="Seleccione el tipo de documento"
                                            value="DNI" required> 
                                        <mat-option value="DNI">DNI</mat-option>
                                        <mat-option value="Pasaporte">Pasaporte</mat-option>
                                        </mat-select>
                                        <mat-hint style="color: red;" *ngIf="stepOneForm.get('tipoDocumento')?.touched && stepOneForm.get('tipoDocumento')?.hasError('required')">
                                            Debe seleccionar el tipo de documento
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                </div>
                                <div class="col-md-11 label-input">
                                    <mat-label >Ingrese aquí el N° de Documento (Ej: 70412550)</mat-label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                    <img src="../../../../assets/icons/nro-documento.svg" alt="Imagen" class="imagen-input"/>

                                </div>
                                <div class="col-md-11">
                                    <mat-form-field appearance="outline">
                                        <input matInput maxlength="8" formControlName="numeroDocumento" placeholder="" required (keypress)="validateFormat($event)"/>
                                        <mat-hint style="color: red;" *ngIf="stepOneForm.get('numeroDocumento')?.touched && stepOneForm.get('numeroDocumento')?.hasError('required') && (SubmitForm||stepOneForm.get('numeroDocumento')?.dirty)">
                                            Debe escribir su número de documento
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                </div>
                                <div class="col-md-11 label-input">
                                    <mat-label >Ingrese aquí su número de celular (Ej: 991144192)</mat-label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                    <img src="../../../../assets/icons/ph_phone.svg" alt="Imagen" class="imagen-input"/>

                                </div>
                                <div class="col-md-11">
                                    <mat-form-field appearance="outline">
                                        <input matInput maxlength="9" formControlName="numeroCelular" placeholder="" required (keypress)="validateFormat($event)"/>
                                        <mat-hint style="color: red;" *ngIf="stepOneForm.get('numeroCelular')?.touched && stepOneForm.get('numeroCelular')?.hasError('required') && (SubmitForm||stepOneForm.get('numeroCelular')?.dirty)">
                                            Debe escribir su número de celular
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                </div>
                                <div class="col-md-11 label-input">
                                    <mat-label >Ingrese la fecha de su nacimiento (dia/mes/año):</mat-label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                    <img src="../../../../assets/icons/tabler_calendar-event.svg" alt="Imagen" class="imagen-input"/>

                                </div>
                                <div class="col-md-11">
                                    <mat-form-field appearance="outline">
                                        <input matInput formControlName="fechaNacimiento" placeholder="Fecha de nacimiento (dia/mes/año)" [matDatepicker]="picker" required>
                                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                        <mat-datepicker #picker startView="multi-year" [startAt]="startDate"></mat-datepicker>
                                        <mat-hint style="color: red;" *ngIf="stepOneForm.get('fechaNacimiento')?.touched && stepOneForm.get('fechaNacimiento')?.hasError('required') && (SubmitForm||stepOneForm.get('fechaNacimiento')?.dirty)">
                                            Debe escribir o seleccionar su fecha de nacimiento
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>

                        </form>
                        <div class="center">
                            <button mat-raised-button color="primary" (click)="nextStep(0)" matStepperNext>Siguiente</button>   
                        </div>
                    </mat-step >
                    <!-- Paso 2: Síntomas y especialidad -->
                    <mat-step [stepControl]="stepTwoForm" [editable]="true">
                        <ng-template matStepperIcon="edit">
                            <mat-icon>check</mat-icon>
                        </ng-template>
                        <ng-template matStepLabel>Paso 2: Síntomas y especialidad</ng-template>
                        <form [formGroup]="stepTwoForm">
                            <br>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                </div>
                                <div class="col-md-11 label-input">
                                    <mat-label >Escribe la especialidad:</mat-label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                    <img src="../../../../assets/icons/solar--user-id-outline.svg" alt="Imagen" class="imagen-input"/>

                                </div>
                                <div class="col-md-11">
                                    <mat-form-field appearance="outline">
                                        <input matInput 
                                        placeholder="Escribe la especialidad" 
                                        formControlName="especialidad" 
                                        [matAutocomplete]="auto"
                                        required>
                                        <!--
                                        <mat-select formControlName="especialidad">
                                        <mat-option value="Cardiología">Cardiología</mat-option>
                                        <mat-option value="Dermatología">Dermatología</mat-option>
                                        </mat-select>-->
                                        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
                                            <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
                                                {{ option }}
                                              </mat-option>
                                          </mat-autocomplete>
                                        <mat-hint style="color: red;" *ngIf="stepTwoForm.get('especialidad')?.touched && stepTwoForm.get('especialidad')?.hasError('required') && (SubmitForm||stepTwoForm.get('especialidad')?.dirty)">
                                            Debe escribir o seleccionar la especialidad
                                        </mat-hint>
                                        <mat-hint style="color: red;" *ngIf="stepTwoForm.get('especialidad')?.value && 
                                            !verificarValor(stepTwoForm.get('especialidad')?.value)">
                                            La especialidad ingresada no es válida
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                </div>
                                <div class="col-md-11 label-input">
                                    <mat-label>Ingrese algún mensaje u observación de sus sintomas:</mat-label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                    <img src="../../../../assets/icons/lets-icons_comment.svg" alt="Imagen" class="imagen-input"/>
                                </div>
                                <div class="col-md-11">
                                    <mat-form-field appearance="outline">
                                        <input matNativeControl 
                                        formControlName="sintomas" 
                                        placeholder="Síntomas" required>
                                    <!-- </input> -->
                                        <mat-hint style="color: red;" *ngIf="stepTwoForm.get('sintomas')?.touched && stepTwoForm.get('sintomas')?.hasError('required') && (SubmitForm||stepTwoForm.get('sintomas')?.dirty)">
                                            Escriba sus sintomas
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>
                        </form>
                        <div>
                        <button mat-button matStepperPrevious>Atrás</button>

                        <!-- <button mat-raised-button color="primary" (click)="nextStep(1)" matStepperNext>Siguiente</button> -->
                        <button mat-raised-button color="primary" (click)="nextStep(1)"  matStepperNext>Siguiente</button>   

                        </div>
                    </mat-step>
                    <!-- Paso 3: Fecha de cita -->
                    <mat-step [stepControl]="stepThreeForm" [editable]="true">
                        <ng-template matStepLabel>Paso 3: Fecha de cita</ng-template>
                        <form [formGroup]="stepThreeForm">
                            <br>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                </div>
                                <div class="col-md-11 label-input">
                                    <mat-label>Selecciona la fecha de su cita (dia/mes/año):</mat-label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-1" style="padding-left: 0%;">
                                    <img src="../../../../assets/icons/tabler_calendar-event.svg" alt="Imagen" class="imagen-input"/>

                                </div>
                                <div class="col-md-11">
                                    <mat-form-field appearance="outline">
                                        <input matInput formControlName="fechaCita" placeholder="Fecha de cita" [matDatepicker]="pickerCita"
                                        [min]="ahora" (dateChange)="onSelect($event)" >
                                        <mat-datepicker-toggle matSuffix [for]="pickerCita"></mat-datepicker-toggle>
                                        <mat-datepicker #pickerCita ></mat-datepicker>
                                        <mat-hint style="color: red;" *ngIf="stepThreeForm.get('fechaCita')?.touched && stepThreeForm.get('fechaCita')?.hasError('required') && (SubmitForm||stepThreeForm.get('fechaCita')?.dirty)">
                                            Debe escribir o seleccionar su fecha de cita
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div *ngIf="selectedDate">
                                <div class="row">
                                    <div class="col-md-1" style="padding-left: 0%;display: flex;justify-content: center;">
                                        <mat-icon class="icon-input">
                                            schedule
                                        </mat-icon>
                                    </div>
                                    <div class="col-md-11 label-input" style="align-items: center; display:flex">
                                        <mat-label>Elige tu hora:</mat-label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-1" style="padding-left: 0%;"></div>
                                    <div class="col-md-11">
                                        <div class="time-buttons">
                                            <button mat-stroked-button color="primary" 
                                            *ngFor="let hour of availableHours" 
                                            (click)="selectHour(hour)" 
                                            [disabled]="isHourDisabled(hour)"
                                            [class.selected]="isSelectedHour(hour)"
                                            class="button-hour">
                                                {{ hour }}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <br>
                        <div>
                            <button mat-button matStepperPrevious>Atrás</button>
                            <button mat-raised-button color="primary" (click)="submitForm()">Enviar</button>
                        </div>
                    </mat-step>
                </mat-stepper>
              </mat-card-content>
            </mat-card>
            <mat-card *ngIf="StepperForm == 1">
                <mat-card-header style="justify-content: center;">
                    <mat-card-title><h3>Resumen de la cita médica</h3></mat-card-title>
                </mat-card-header>
                <mat-card-content class="text-left">
                    <table mat-table class="summary-table" [dataSource]="dataSource" aria-label="Tabla de resumen" >
                        <ng-container matColumnDef="property">
                          <td mat-cell *matCellDef="let element" class="table-cell">{{element.label}}</td>
                        </ng-container>
                  
                        <ng-container matColumnDef="value">
                          <td mat-cell *matCellDef="let element" class="table-cell">{{element.value}}</td>
                        </ng-container>
                  
                        <tr mat-row *matRowDef="let row; columns: ['property', 'value'];"></tr>
                    </table>
                  
                </mat-card-content>
                <mat-card-actions style="justify-content: center;margin-top: 18px;margin-bottom: 18px;">
                    <button mat-button (click)="backForm()" style="margin-right: 20px;">Atrás</button>

                    <button mat-raised-button color="primary" (click)="confirmtForm()">Confirmar</button>
                </mat-card-actions>
            </mat-card>
          </div>

    </div>

  </div>
